-- Author: rekahhhh

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local StarterGui = game:GetService("StarterGui")

repeat task.wait() until game:IsLoaded() and LocalPlayer

task.wait(5)  -- Reduced loading time to 5 seconds

local CONFIG = {
    MatchmakingPlaceIDs = {
        [16883972004] = true,
        [16722271122] = true,
        [16883976493] = true,
        [16787374647] = true,
        [16895606055] = true,
        [18637069183] = true
    },
    
    CullingGamePlaceID = 115509275831248,
    
    SpecialPlaceID = 14067600077,
    
    AntiAFKEnabled = true,
    AntiAFKInterval = 120,
    MoveDistance = 0.5,
    
    ReEntryDelay = 1000,
    GameLoadTime = 25,
}

local function getCurrentPlaceID()
    return game.PlaceId
end

local function isInMatchmaking()
    local currentPlaceID = getCurrentPlaceID()
    return CONFIG.MatchmakingPlaceIDs[currentPlaceID] == true
end

local function isInCullingGames()
    local currentPlaceID = getCurrentPlaceID()
    return currentPlaceID == CONFIG.CullingGamePlaceID
end

local function isInSpecialArea()
    local currentPlaceID = getCurrentPlaceID()
    return currentPlaceID == CONFIG.SpecialPlaceID
end

local function enterMatchmakingHub()
    pcall(function()
        local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
        if playerGui then
            local function searchForMatchmakingButton(instance)
                if typeof(instance) == "Instance" then
                    if instance:IsA("TextButton") or instance:IsA("ImageButton") then
                        local name = instance.Name:lower()
                        local text = ""
                        if instance:IsA("TextButton") then
                            text = instance.Text:lower()
                        end
                        
                        if name:find("matchmaking") or text:find("matchmaking") then
                            pcall(function()
                                instance:Activate()
                            end)
                            return true
                        end
                    end
                    
                    for _, child in ipairs(instance:GetChildren()) do
                        if searchForMatchmakingButton(child) then
                            return true
                        end
                    end
                end
                return false
            end
            
            searchForMatchmakingButton(playerGui)
        end
    end)
end

local function useSlotA()
    pcall(function()
        task.wait(1)
        local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
        if playerGui then
            local function searchForSlotAButton(instance)
                if typeof(instance) == "Instance" then
                    if instance:IsA("TextButton") or instance:IsA("ImageButton") then
                        local name = instance.Name:lower()
                        local text = ""
                        if instance:IsA("TextButton") then
                            text = instance.Text:lower()
                        end
                        if (name:find("slot") and name:find("a")) or (text:find("slot") and text:find("a")) then
                            pcall(function()
                                instance:Activate()
                            end)
                            return true
                        end
                    end
                    for _, child in ipairs(instance:GetChildren()) do
                        if searchForSlotAButton(child) then
                            return true
                        end
                    end
                end
                return false
            end
            searchForSlotAButton(playerGui)
        end
    end)
end

local function enterCullingGames()
    pcall(function()
        -- Correct remote path and parameters
        local teamRemote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("Team")
        if teamRemote and teamRemote:IsA("RemoteEvent") then
            print("Firing Team remote event with correct parameters")
            teamRemote:FireServer("JoinQueue", "CULLING GAMES")
            task.wait(0.1)
        else
            print("Remotes.Team not found or not a RemoteEvent")
        end

        -- Find and click GUI button for entering queue
        local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
        if playerGui then
            local function searchForQueueButton(instance)
                if typeof(instance) == "Instance" then
                    if instance:IsA("TextButton") or instance:IsA("ImageButton") then
                        local name = instance.Name:lower()
                        local text = ""
                        if instance:IsA("TextButton") then
                            text = instance.Text:lower()
                        end
                        if name:find("queue") or text:find("queue") then
                            print("Found QUEUE button: " .. instance.Name)
                            if instance.Visible and instance.Active then
                                print("Button is visible and active, attempting to click...")
                                -- Try various click methods
                                pcall(function() instance:Activate() end)
                                pcall(function() instance.MouseButton1Click:Fire() end)
                                pcall(function()
                                    instance.MouseButton1Down:Fire()
                                    task.wait(0.05)
                                    instance.MouseButton1Up:Fire()
                                end)
                                return true
                            end
                        end
                    end
                    for _, child in ipairs(instance:GetChildren()) do
                        if searchForQueueButton(child) then
                            return true
                        end
                    end
                end
                return false
            end
            searchForQueueButton(playerGui)
        end
    end)
end

local function antiAFK()
    local lastMove = tick()
    while true do
        task.wait(60)
        pcall(function()
            if CONFIG.AntiAFKEnabled and isInCullingGames() then
                local now = tick()
                if now - lastMove > CONFIG.AntiAFKInterval then
                    if LocalPlayer.Character and 
                       LocalPlayer.Character:FindFirstChild("Humanoid") and 
                       LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                        
                        local moveDirection = Vector3.new(
                            (math.random() - 0.5) * CONFIG.MoveDistance,
                            0,
                            (math.random() - 0.5) * CONFIG.MoveDistance
                        )
                        
                        LocalPlayer.Character.Humanoid:Move(moveDirection, true)
                        task.wait(0.2)
                        LocalPlayer.Character.Humanoid:Move(Vector3.new(0, 0, 0), true)
                        
                        lastMove = now
                    end
                end
            end
        end)
    end
end

local function gameStateManager()
    local lastReEntry = tick()
    local inCullingPreviously = false
    local statusReportTime = tick()
    local specialAreaHandled = false
    
    while true do
        task.wait(2)
        pcall(function()
            local now = tick()
            if now - statusReportTime > 300 then
                print("Type Soul Auto Culling: Still running...")
                statusReportTime = now
            end
            
            if isInSpecialArea() and not specialAreaHandled then
                enterMatchmakingHub()
                task.wait(1)
                useSlotA()
                specialAreaHandled = true
                lastReEntry = now
            elseif not isInSpecialArea() then
                specialAreaHandled = false
            end
            
            if isInMatchmaking() then
                print("Detected matchmaking area, entering culling games...")
                enterCullingGames()
                lastReEntry = now
            end
            
            local currentlyInCulling = isInCullingGames()
            if inCullingPreviously and not currentlyInCulling then
                print("Detected return to matchmaking, re-entering culling games...")
                task.wait(1)
                enterCullingGames()
                lastReEntry = now
            end
            
            if now - lastReEntry > CONFIG.ReEntryDelay then
                print("Fallback re-entry triggered...")
                enterCullingGames()
                lastReEntry = now
            end
            
            inCullingPreviously = currentlyInCulling
            
            if currentlyInCulling and not inCullingPreviously then
                task.wait(CONFIG.GameLoadTime)
            end
        end)
    end
end

task.spawn(function()
    task.wait(1)
    antiAFK()
end)

task.spawn(function()
    task.wait(1)
    gameStateManager()
end)

print("Script Has loaded !! ( @rekahhhhh on discord btw !!")
